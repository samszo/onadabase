<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="800" height="300" 
	title="Liste des diagnostics" showCloseButton="true"
	close="PopUpManager.removePopUp(this);"  
     backgroundColor="#FBFBF8" borderColor="#F9F005"
      creationComplete="CursorManager.setBusyCursor()" > 
            
	<mx:Script>
        <![CDATA[
        	import mx.controls.Image;
        	import mx.collections.ArrayCollection;
        	import mx.containers.HBox;
            import mx.controls.Alert;
            import mx.rpc.http.HTTPService;
            import mx.rpc.events.ResultEvent;
            import mx.rpc.events.FaultEvent;
	       	import mx.managers.PopUpManager;
			import mx.managers.CursorManager;
		    import compo.hbLieuDiag;
           
            private var service:HTTPService;

            public function useHttpService(srvUrl:String,parameters:Object):void {
                service = new HTTPService();
                service.url = srvUrl;
                //service.method = "POST";
                service.addEventListener("result", httpResult);
                service.addEventListener("fault", httpFault);
                service.send(parameters);
            }

            public function httpResult(event:ResultEvent):void {
                if(event.result!=""){
	                var rsListe:Object = event.result;
                }
                //boucle sur les critères
		        for each (var rLieu:Object in rsListe.vbox.lieu)
		        {
        	        var hbLC:hbLieuDiag = new hbLieuDiag();
        	        hbLC.rsLieu=rLieu;
   					mainCtrl.addChild(hbLC);

/*
		        	var lieuHB:HBox = new HBox();
					//construction du fil d'ariane
			        for each (var rAriane:Object in rLieu.ariane.hbox.label)
			        {
				        var arLbl:Label = new Label();
				        arLbl.text = rAriane.value;
			        	lieuHB.addChild(arLbl);
			        }
			        //à cause d'un drole de comportement su le for each
			        if(rLieu.crit.length){
						//construction de la legende quand il y a plusieurs critères
			            for (var i:int=0; i<rLieu.crit.length; i++) {
				        	var critHB:VBox = new VBox();
							//construction du texte de la legende
					        for each (var rTxtLegende:Object in rLieu.crit[i].legende.vbox.hbox[0].label)
					        {
						        var legLbl:Label = new Label();
						        legLbl.text = rTxtLegende.value;
					        	critHB.addChild(legLbl);				        	
					        }
	
							//construction des image de la legende
					        for each (var rImaLegende:Object in rLieu.crit[i].legende.vbox.hbox[1].image)
					        {
						        var legIma:Image = new Image;
						        legIma.source = rTxtLegende.value;
					        	critHB.addChild(legIma);				        	
					        }			        	

							//construction des liens du critère
					        var liensIma:Image = new Image;
					        liensIma.source = rLieu.crit[i].liens.vbox.hbox[0].image.src;
				        	critHB.addChild(liensIma);				        	
					        var lienLbl:Label = new Label();
					        lienLbl.text = rLieu.crit[i].liens.vbox.hbox[0].image.onclick;
				        	critHB.addChild(lienLbl);				        	
					        //ajoute le critère au conteneur
				        	lieuHB.addChild(critHB);
				        }
			        }else{
						//construction de la legende quand il y un seul critère
			        	var critHB:VBox = new VBox();
						//construction du texte de la legende
				        for each (var rTxtLegende1:Object in rLieu.crit.legende.vbox.hbox[0].label)
				        {
					        var legLbl1:Label = new Label();
					        legLbl1.text = rTxtLegende1.value;
				        	critHB.addChild(legLbl1);				        	
				        }

						//construction des image de la legende
				        for each (var rImaLegende1:Object in rLieu.crit.legende.vbox.hbox[1].image)
				        {
					        var legIma1:Image = new Image;
					        legIma1.source = rTxtLegende1.value;
				        	critHB.addChild(legIma1);				        	
				        }			        	
				        //ajoute le critère au conteneur
			        	lieuHB.addChild(critHB);
			        }			        
			        //ajoute le critère au conteneur
					mainCtrl.addChild(lieuHB);
*/
		        }
				CursorManager.removeBusyCursor();
            
            }

            public function httpFault(event:FaultEvent):void {
				CursorManager.removeBusyCursor();
                var faultstring:String = event.fault.faultString;
                Alert.show(faultstring);
            }
        ]]>
    </mx:Script>

	<mx:VBox id="mainCtrl" width="100%" x="5" y="5">
	</mx:VBox>
	
</mx:TitleWindow>
